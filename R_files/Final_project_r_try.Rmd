---
title: "DataMinningFinalProject"
author: "Fabio Vaquera"
date: "2022-11-30"
output: html_document
editor_options: 
  chunk_output_type: console
---
Determinantes de la discriminación utilizando la db eh21

```{r}
rm(list = ls())
library(dplyr)
library(nortest)
library(factoextra)
library(haven)
library(ggplot2)
library(grid)
library(gridExtra)
library(corrplot) 


load(url("https://github.com/AlvaroLimber/MD_UCB/raw/main/eh21.RData"))


dataY <- eh21di%>% mutate(dis = (s10a_01c == 1)) %>%
  select(folio,dis, s10a_01c) 

dataX <- eh21v %>%mutate (luz = (s07a_16 == 2) , agua =(s07a_16 == 7 | s07a_10 == 8),
                           material = (s07a_03 == 2 | s07a_03 ==6))%>% 
  select(folio, s07a_01, agua, luz,material, s07a_16, s07a_10, s07a_03)

dataProject <- eh21p%>% 
  mutate (sueldo = (ylab<2500), est = (aestudio <12), pind = (s01a_09 == 1), 
          campo = (area == 2), ed = (s01a_03 >= 15 )  ) %>%
  select (folio, sueldo, est, pind, campo,s01a_09,
          s01a_02,depto, aestudio, area, s01a_03, ylab ) %>%
inner_join(dataY)  %>% inner_join(dataX) %>% group_by(folio) %>% na.omit()# %>%
  # filter(aestudio < 12, ylab < 2000 , s01a_10 == 1, area == 2 )

#agua no en cañeria 
#sin luz 
#para agregar
 #factor(s07a_01)


dataProject <- dataProject[,-1]
sqrt(dataProject)
dataProject <- scale(dataPro)

hist(log(dataProject$aestudio))
barplot(table(eh21p$aestudio))


m1 <- lm(aestudio ~ factor(s07a_10)+ylab  +s01a_02+sueldo+factor(area) +
           s01a_03+factor(s01a_09)+factor(s07a_16), data= dataProject)

summary(m1)
coefficients(m1)
e<- residuals(m1)

summary(e)
hist(e) 
ad.test(e)
lillie.test(e)

plot(density(e))
curve(dnorm(x, 0, sd(e)), add=T, col="red")
?curve()


m2 <- lm(log(s01a_02) ~ factor(depto)  +pind+ luz+
           campo + est +sueldo + agua+dis, data= dataProject)

summary(m2)
coefficients(m2)
e2<- residuals(m2)

summary(e2)
hist(e2) 
ad.test(e2)
lillie.test(e2)

plot(density(e2))
curve(dnorm(x, 0, sd(e2)), add=T, col ="red")


cooks.distance(m2)
plot(cooks.distance(m2))

summary(cooks.distance(m2))
table(is.na(cooks.distance(m2)))

quantil <- quantile(cooks.distance(m2), c(0.90), na.rm = T) 
aux1 <- dataProject %>% filter (cooks.distance(m2) <= quantil[[1]]) 

m3  <- lm(log(s01a_02) ~ factor(depto)  +pind+ luz+
           campo + est +sueldo + agua+dis, data= dataProject)

summary(m3)
coefficients(m3)
e3<- residuals(m3)

library(car)
vv<-vif(m3)
sqrt(vv[,1])


summary(e3)
hist(e3) 
ad.test(e3)
lillie.test(e3)

plot(density(e3))
curve(dnorm(x, 0, sd(e3)), add=T, col ="red")
library(lmtest)
bptest(m3)




```

